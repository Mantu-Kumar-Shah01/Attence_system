{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <title>Manager Dashboard</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,600&display=swap" rel="stylesheet" />
    {% load static %}

    <link rel="stylesheet" href="{% static 'CSS_file/manager_dashB.css' %}">
</head>

<body>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="nav-left">
            <img src="{% static 'images/ggi_logo.png' %}" alt="Logo">
        </div>

        <div class="nav-right">
            <a href="/">Home</a>
            <a href="{% url 'logout' %}" id="logoutcolor" class="btn">Logout</a>
        </div>
    </nav>

    <!-- Main Wrapper -->
    <div class="wrapper">

        <!-- Sidebar -->
        <div class="sidebar">
           <div id="greeting">
    {{ greeting }},<p>Manager: {{ emp.E_name }}!</p>
           </div>



            <div class="permission-buttons "  style="margin-top: 20px;">
                {% if permissions.can_add_employee %}
                <button class="permission-btn enabled" onclick="showSection('add_employee')"> Add Employee</button>
                {% else %}
                <button class="permission-btn disabled" disabled>Add Employee</button>
                {% endif %}

                {% if permissions.can_edit_salary %}
                <button class="permission-btn enabled" onclick="showSection('edit_salary')"> Edit Salary</button>
                {% else %}
                <button class="permission-btn disabled" disabled> Edit Salary</button>
                {% endif %}

                <!-- Add this button in your manager dashboard -->
                <div class="manager-actions permission-buttons" >
                  <div>  <a href="{% url 'manager_salary_overview' %}" class="btn enabled  permission-btn" >
                        View Employees Salaries
                    </a></div>
                    
                    <div> <a href="{% url 'manager_dashboard' %}" class="btn  permission-btn" >
                        Attendance Overview
                    </a></div>
                </div>

                {% if permissions.can_delete_employee %}
                <button class="permission-btn enabled" onclick="showSection('delete_employee')"> Delete</button>
                {% else %}
                <button class="permission-btn disabled" disabled> Delete</button>
                {% endif %}

                {% if permissions.can_view_reports %}
                <button class="permission-btn enabled" onclick="showSection('view_reports')"> Reports</button>
                {% else %}
                <button class="permission-btn disabled" disabled> Reports</button>
                {% endif %}
                
            </div>
        </div>

        <!-- Content Area -->
        <div class="content">

            {% if permissions.can_view_attendance %}
            <div id="view_attendance" class="content-section active">
                <div class="section-header">
                    <h2>Attendance Records</h2>
                </div>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Employee Name</th>
                                <th>Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for a in attendance %}
                            <tr>
                                <td>{{ a.employee.E_name }}</td>
                                <td>{{ a.date }}</td>
                                <td>{{ a.status }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="3" class="no-data">No attendance records.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}

            {% if permissions.can_edit_salary %}
            <div id="edit_salary" class="content-section">
                <div class="section-header">
                    <h2>Edit Employee Salary</h2>
                </div>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Employee Name</th>
                                <th>Employee ID</th>
                                <th>Current Salary</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for e in employees %}
                            <tr>
                                <td>{{ e.E_name }}</td>
                                <td>{{ e.E_id }}</td>
                                <td>‚Çπ{{ e.salary }}</td>
                                <td>
                                    <a href="{% url 'edit_salary' e.id %}" class="btn"> Edit</a>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="no-data">No employees found.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}

            {% if permissions.can_add_employee %}
            <div id="add_employee" class="content-section">
                <div class="section-header">
                    <h2> Add New Employee</h2>
                </div>

                {% if error %}
                <div class="alert error" role="alert">‚ùå {{ error }}</div>
                {% endif %}

                {% if success %}
                <div class="alert success" role="status">‚úÖ {{ success }}</div>
                {% endif %}

                <div class="form-container" style="display: flex; justify-content: center; align-items: center; min-height: 400px;">
                    <form method="POST" style="width: 100%; max-width: 450px;">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="E_id">Employee ID *</label>
                            <input type="text" id="E_id" name="E_id" required placeholder="Enter Employee ID" />
                        </div>

                        <div class="form-group">
                            <label for="E_name">Employee Name *</label>
                            <input type="text" id="E_name" name="E_name" required placeholder="Enter Employee Name" />
                        </div>

                        <div class="form-group">
                            <label for="salary">Salary (‚Çπ) *</label>
                            <input type="number" id="salary" name="salary" step="0.01" required placeholder="Enter Salary" />
                        </div>

                        <div class="form-group checkbox">
                            <input type="checkbox" id="is_manager" name="is_manager" />
                            <label for="is_manager">Is Manager</label>
                        </div>

                        <div class="form-group">
                            <button type="submit" aria-label="Add Employee"> Add Employee</button>
                        </div>
                    </form>
                </div>
            </div>
            {% endif %}

            {% if permissions.can_delete_employee %}
            <div id="delete_employee" class="content-section">
                <div class="section-header">
                    <h2> Delete Employee</h2>
                </div>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Employee Name</th>
                                <th>Employee ID</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for e in employees %}
                            <tr>
                                <td>{{ e.E_name }}</td>
                                <td>{{ e.E_id }}</td>
                                <td>
                                    <a href="{% url 'delete_employee' e.id %}" class="btn delete">Delete</a>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="3" class="no-data">No employees found.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}

            {% if permissions.can_view_reports %}
            <div id="view_reports" class="content-section">
                <div class="section-header">
                    <h2> Reports</h2>
                </div>
                <div class="stats-box">
                    <p>üìà Total Employees: <strong>{{ employees|length }}</strong></p>
                    <p>üìã Total Attendance Records: <strong>{{ attendance|length }}</strong></p>
                </div>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Employee Name</th>
                                <th>Employee ID</th>
                                <th>Present Count</th>
                                <th>Absent Count</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for e in employees %}
                            <tr>
                                <td>{{ e.E_name }}</td>
                                <td>{{ e.E_id }}</td>
                                <td>{{ e.present_count }}</td>
                                <td>{{ e.absent_count }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="no-data">No employees found.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}

        </div>
    </div>

    <script>
        function showSection(sectionId) {
            // Hide all content sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });

            // Show selected section
            const selected = document.getElementById(sectionId);
            if (selected) {
                selected.classList.add('active');
            }
        }
    </script>



</body>

</html>
